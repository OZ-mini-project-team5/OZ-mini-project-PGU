version: "3.11" #Docker ComposerAPI 버전을 의미
#giung

services:
  app: #Django
    build:
      context: .
      args:
        - DEV=true
    ports:
      - "8000:8000"
    volumes:
      - ./app:/app
    command: >
      sh -c "python manage.py wait_for_db &&
             python manage.py migrate &&
             python manage.py runserver 0.0.0.0:8000"
    #상호 간에 데이터를 주고 받게 하기 위해
    environment:
      - DB_HOST=db
      - DB_NAME=miniproject
      - DB_USER=gomnonix
      - DB_PASS=password123
    depends_on: #db가 준비가 되면 이 컨테이너를 실행 시켜줘
      - db
  
  db: # PostgreSQL Database
    image: postgres:16-alpine
    volumes:
      - ./data/db:/var/lib/postgresql/data #local에서 진행하면 data라는 파일을 만든다.: 경로를 여기로 옮긴다.
    environment: # 환경변수, db를 만들면 접속할 수 있게해야하는데 key: value를 설정한다.
      - POSTGRES_DB=miniproject
      - POSTGRES_USER=gomnonix
      - POSTGRES_PASSWORD=password123